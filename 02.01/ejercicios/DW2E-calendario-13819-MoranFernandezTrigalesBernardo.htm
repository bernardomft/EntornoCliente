<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        var fechas = [];
        var semana = ['D', 'L', 'M', 'X', 'J', 'V', 'S'];

        function iniciar() {
            iniciarAño(fechas);
            console.log(fechas);
            dibujarFechas(fechas);
        }

        function dibujarFechas(fechas) {
            var ele = document.createElement('div');
            ele.id = 'div-general';
            document.body.appendChild(ele);
            /*for (var i = 0; i < fechas.length; i++) {
                for (var j = 0; j < fechas[i].length ; j++) {
                    if(fechas[i][j] === fechas[i][0])
                        generarFechasAnteriores(fechas, ele, i,j);
                    crearCajas(fechas, ele, i, j);
                }
            }*/
            //No he sido capaz de poner las fechas que van delante dle primer dia del mes
            //solo consigo que se pongan para la primera fila
            var i = 0, j = 0;
            while(i < fechas.length)
            {
                while(j < fechas[i].length)
                {
                    if(fechas[i][j].getDate() === 1)
                        generarFechasAnteriores(fechas, ele, i,j);
                    crearCajas(fechas, ele, i, j);
                    j++;
                }
                j = 0;
                i++;
            }
        }

        function generarFechasAnteriores(fechas, ele, i, j)
        {
            var n = fechas[i][j].getDay()+6;
            while( n > 0)
            {       
                    var dia = new Date();
                    dia.setUTCDate(fechas[i][0].getDate() - n);
                    var caja = document.createElement('div');
                    caja.style.width = '20px';
                    caja.style.backgroundColor = 'yellow';
                    caja.style.border = '1px solid #000000';
                    caja.style.margin = '0.2em';
                    caja.style.float = 'left';
                    caja.id = dia.getDate() + '_' + dia.getUTCMonth();
                    var p1 = document.createElement('p');
                    p1.innerHTML = dia.getDate();
                    p1.style.textAlign = 'center';
                    var p2 = document.createElement('p');
                    p2.innerHTML = semana[dia.getDay()];
                    p2.style.textAlign = 'center';
                    caja.appendChild(p1);
                    caja.appendChild(p2);
                    ele.appendChild(caja);
                    n--;
            }
        }

        function crearCajas(fechas, ele , i, j)
        {
            var caja = document.createElement('div');
                    caja.style.width = '20px';
                    //caja.style.height = '30px';
                    caja.style.backgroundColor = 'yellow';
                    caja.style.border = '1px solid #000000';
                    caja.style.margin = '0.2em';
                    caja.style.float = 'left';
                    if(j === 0) //Esto no funciona bien. El dia 31 lo pone en la fila sigiente
                        caja.style.clear = 'left';
                    caja.id = fechas[i][j].getDate() + '_' + fechas[i][j].getUTCMonth();
                    var p1 = document.createElement('p');
                    p1.innerHTML = fechas[i][j].getDate();
                    p1.style.textAlign = 'center';
                    var p2 = document.createElement('p');
                    p2.innerHTML = semana[fechas[i][j].getDay()];
                    p2.style.textAlign = 'center';
                    caja.appendChild(p1);
                    caja.appendChild(p2);
                    ele.appendChild(caja);
                    
        }
        function iniciarAño(fechas) {
            for (var i = 0; i < 12; i++) {
                fechas.push(getDaysInMonthUTC(i, 2020));
            }
        }

        function getDaysInMonthUTC(month, year) {
            var date = new Date(Date.UTC(year, month, 1));
            var days = [];
            while (date.getUTCMonth() === month) {
                days.push(new Date(date));
                date.setUTCDate(date.getUTCDate() + 1);
            }
            return days;
        }
        window.onload = iniciar();
    </script>
</body>

</html>