<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>videos</title>
    <style>
        .filtros {
            border: 1px solid #000000;
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            margin: 2em auto;
            width: 90%;
        }

        .filtros p {
            flex-basis: 18%;
            cursor: pointer;
        }


        .imagen {
            background-size: contain;
            background-repeat: no-repeat;
            width: 180px;
            height: 100px;
        }

        .contenedor {
            border: 1px solid #000000;
            max-height: 25em;
            width: 90%;
            margin: 0 auto;

        }

        #flex {
            display: flex;
            flex-direction: row;
            white-space: nowrap;
            overflow: scroll;
        }

        p {
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <script>
        //Array con id de videos de Youtube
        var arrayId = ['gOpWZ95Nd8k', '4q4o-BIHJZA', 'm2Japz0oJek', '4MeHm43BQQo', 'fFPfHIOlKPM', 'ryEcAT0IfTI',
            'wWWlmfnfLAU', 'ywwfV2VqBNg', 'z5VyCp_1YnA', 'IK01V1oED9w'
        ];
        var arrayFiltros = ['TODOS', 'FILTRO: 1-5', 'OX TITULO', 'OX SUBIDA', 'OX VISITAS','OX DURACION'];

        var arrayObj = [];
        //Clase pelicula
        class Pelicula {
            constructor(vid) {
                this._vid = vid;
                this._titulo = randomChar(5);
                this._duracion = crearDuracion();
                this._fechaSubida = crearFecha();
                this._visitas = Math.floor(Math.random() * (1000000 - 100) + 1000);;
                this._imagen = 'https://i.ytimg.com/vi/' + vid + '/mqdefault.jpg';
            }

            //seters
            set vid(v) {
                this._vid = v;
            }

            set titulo(titulo) {
                this._titulo = titulo;
            }

            set duracion(duracion) {
                this._duracion = duracion;
            }

            set fechaSubida(fechaSubida) {
                this._fechaSubida = fechaSubida;
            }

            set visitas(visitas) {
                this._visitas = visitas;
            }

            set imagen(imagen) {
                this._imagen = imagen;
            }

            //geters

            get vid() {
                return this._vid;
            }

            get titulo() {
                return this._titulo;
            }

            get duracion() {
                return this._duracion;
            }

            get fechaSubida() {
                return this._fechaSubida;
            }

            get visitas() {
                return this._visitas;
            }

            get imagen() {
                return this._imagen;
            }

            generarHTML(i) {
                //div.tarjeta (div principal)
                var ele = document.createElement('div');
                ele.id = 'pelicula_' + this.vid;
                //div con imagen
                var imagen = document.createElement('div');
                imagen.className = 'imagen';
                imagen.style.backgroundImage = 'url(' + this.imagen + ')';
                var p = document.createElement('p');
                p.innerHTML = (i + 1) + ':' + this.titulo + '<br>' + this.vid + '<br>' + this.fechaSubida +
                    '<br>' + this.visitas;
                ele.appendChild(imagen);
                ele.appendChild(p);
                //ele = document.getElementById('flex').insertBefore(ele,document.getElementById('paginador'));
                document.getElementById('flex').appendChild(ele);
            }

        }

        function iniciar() {
            crearEstructura();
            for (var i = 0; i < arrayId.length; i++) {
                arrayObj.push(new Pelicula(arrayId[i]));
                arrayObj[i].generarHTML(i);
            }
            console.log(arrayObj);
        }

        function crearEstructura() {
            //Contenedor filtros
            var cont = document.createElement('div');
            cont.className = 'filtros';
            for (var i = 0; i < arrayFiltros.length; i++) {
                p = document.createElement('p');
                p.innerHTML = arrayFiltros[i];
                p.style.border = '1px solid #000000';
                cont.appendChild(p);
                p.addEventListener('click', ordenarArray);
            }
            document.body.appendChild(cont);
            //Contenedor pelÃ­culas
            var ele = document.createElement('div');
            ele.className = 'contenedor';
            ele.id = 'contenedor-principal';
            var flex = document.createElement('div');
            flex.id = 'flex';
            ele.appendChild(flex);
            document.body.appendChild(ele);
        }

        function ordenarArray() {
            var c = this.innerHTML.charAt(3);
            if(this.innerHTML.charAt(0) === 'T')
                eliminarVideos();
            else if(c === 'T' && this.innerHTML.charAt(2) === 'L')
                eliminarVideos2();
            else if (c === 'T')
                ordenaTitulo();
            else if (c === 'S')
                ordenaSubida();
            else if (c === 'V')
                ordenaVisitas();
            else if(c === 'D')
                ordenaDuracion();
            
            //console.log(c);
        }

        function ordenaDuracion() {
            arrayObj.sort(function (a, b) {
                var s1, s2, s3,t1, t2, t3;
                var j = 0,
                    z = 0;
                for (var i = 0; i < a.duracion.length; i++) {
                    if (a.duracion.charAt(i) === '/' && j === 0) {
                        s1 = a.duracion.substring(0, i);
                        z = i;
                        j++;
                    } else if (a.duracion.charAt(i) === '/' && j === 1) {
                        s2 = a.duracion.substring(z + 1, i);
                        s3 = a.duracion.substring(i+1, a.duracion.length)
                        j++;
                    } 
                }
                j = 0; 
                z = 0;
                for (var i = 0; i < b.duracion.length; i++) {
                    if (b.duracion.charAt(i) === '/' && j === 0) {
                        t1 = b.duracion.substring(0, i);
                        z = i;
                        j++;
                    } else if (b.duracion.charAt(i) === '/' && j === 1) {
                        t2 = b.duracion.substring(z + 1, i);
                        t3 = b.duracion.substring(i+1, b.duracion.length)
                        j++;
                    } 
                }
                if(s1 > t1)
                    return 1;
                else if(s1 < t1)
                    return -1;
                else{
                    if(s2 > t2)
                        return 1
                    else if(s2 < t1)
                        return -1;
                    else{
                        if(s3>t3)
                            return 1;
                        else if(s3 < t3)
                            return-1;
                        else
                            return 0;
                    }
                }
            });
            console.log(arrayObj);
            eliminarVideos();
        }

        function ordenaVisitas() {
            arrayObj.sort(function (a, b) {
                return b.visitas - a.visitas;
            });
            console.log(arrayObj);
            eliminarVideos();
        }

        function ordenaSubida() {
            //console.log(typeof (arrayObj[1].fechaSubida));
            arrayObj.sort(function (a, b) {
                var s1, s2, s3, f1, f2;
                var j = 0,
                    z = 0;
                for (var i = 0; i < a.fechaSubida.length; i++) {
                    if (a.fechaSubida.charAt(i) === '/' && j === 0) {
                        s1 = a.fechaSubida.substring(0, i);
                        z = i;
                        j++;
                    } else if (a.fechaSubida.charAt(i) === '/' && j === 1) {
                        s2 = a.fechaSubida.substring(z + 1, i);
                        s3 = a.fechaSubida.substring(i+1, a.fechaSubida.length)
                        j++;
                    } 
                }
                var f1 = new Date(s3 + '-' + s2 + '-' + s1);
                j = 0; 
                z = 0;
                for (var i = 0; i < b.fechaSubida.length; i++) {
                    if (b.fechaSubida.charAt(i) === '/' && j === 0) {
                        s1 = b.fechaSubida.substring(0, i);
                        z = i;
                        j++;
                    } else if (b.fechaSubida.charAt(i) === '/' && j === 1) {
                        s2 = b.fechaSubida.substring(z + 1, i);
                        s3 = b.fechaSubida.substring(i+1, b.fechaSubida.length)
                        j++;
                    } 
                }
                var f2 = new Date(s3 + '-' + s2 + '-' + s1);
                return f1 - f2;
            });
            console.log(arrayObj);
            eliminarVideos();
        }

        function ordenaTitulo() {
            arrayObj.sort(function (a, b) {
                if (a.titulo.toLowerCase() > b.titulo.toLowerCase()) {
                    return 1;
                } else if (a.titulo.toLowerCase() < b.titulo.toLowerCase()) {
                    return -1;
                }
                return 0;
            });
            eliminarVideos();
        }

        function eliminarVideos() {
            var ele = document.getElementById('flex');
            while (ele.firstChild) {
                ele.removeChild(ele.firstChild);
            }
            for (var i = 0; i < arrayObj.length; i++) {
                arrayObj[i].generarHTML(i);
            }
        }

        function eliminarVideos2() {
            var ele = document.getElementById('flex');
            while (ele.firstChild) {
                ele.removeChild(ele.firstChild);
            }
            for (var i = 0; i < 5; i++) {
                arrayObj[i].generarHTML(i);
            }
        }

        function crearDuracion() {
            var n1 = Math.floor(Math.random() * (3));
            var n2 = Math.floor(Math.random() * (60 - 1)) + 1;
            var n3 = Math.floor(Math.random() * (60 - 1)) + 1;
            return n1 + '/' + n2 + '/' + n3;
        }

        function crearFecha() {
            var n1 = Math.floor(Math.random() * (30 - 1) + 1);
            var n2 = Math.floor(Math.random() * (12 - 1)) + 1;
            var n3 = Math.floor(Math.random() * (2020 - 1975)) + 1975;
            return n1 + '/' + n2 + '/' + n3;
        }

        function randomChar(length) {
            var result = '';
            var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            var charactersLength = characters.length;
            for (var i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            return result;
        }

        window.onload = iniciar;
    </script>
</body>


</html>